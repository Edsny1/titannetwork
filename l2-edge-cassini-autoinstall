#!/bin/bash

# Update and upgrade system
echo "Updating and upgrading system..."
sudo apt update && sudo apt upgrade -y

# Install screen if not already installed
echo "Installing screen..."
sudo apt install screen -y

# Start a new screen session named 'titan'
echo "Creating a new screen session 'titan'..."
screen -dmS titan

# Wait briefly for screen session to start
sleep 1

# Switch to the 'titan' screen session
echo "Switching to 'titan' screen session..."
screen -S titan -X stuff $'\n'

# Download and install Titan Network file
echo "Downloading and installing Titan Network file..."
wget -c https://github.com/Titannet-dao/titan-node/releases/download/v0.1.18/titan_v0.1.18_linux_amd64.tar.gz -O - | sudo tar -xz -C /usr/local/bin --strip-components=1

# Start the Titan node
echo "Starting the Titan node..."
/usr/local/bin/titan-edge daemon start --init --url https://test-locator.titannet.io:5000/rpc/v0

# Wait for the node to start up
sleep 10

# Prompt the user for the identity code
echo "Please enter your Titan identity code:"
read identity_code

# Bind the node with the provided identity code
echo "Binding the Titan node with identity code $identity_code..."
/usr/local/bin/titan-edge bind --hash="$identity_code" https://api-test1.container1.titannet.io/api/v2/device/binding

echo "Setup completed."
